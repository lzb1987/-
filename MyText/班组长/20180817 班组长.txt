班组长 20180817 实战经验分享

远程管理 xshell

课程设置目的：将课程和生产环境挂钩


1.设备选型
· 选择服务器的指标
  - 需求决定一切，着眼未来
  - 不要贪图便宜，电费远比你想的贵
  - 机房中空间是稀缺资源，机架式比塔式性价比更高
  - 管理方便、比如螺丝少、支持远程控制
  - 硬件通用性要好，尤其驱动
  - 厂商支持
  - 可替代产品是否广泛
  - 云主机的性价比很高
系统一般推荐CentOS :内置驱动

· CPU是服务器主要指标的一部分，影响cpu性能的主要指标游缓存、主频、核心数量、服务器的cpu一般都是xeon的
  - 目前的上用服务器大体可以分为三类
    - 对称多处理器结构（SMP）
    - 非一致存储访问结构（NUMA）
· SMP:
SMP服务器的主要特征是共享，系统中所有资源（CPU、内存、I/O等）都是共享的。也正是由于这种特征，导致了SMP服务器的主要问题就是扩展能力非常有限。对于SMP服务器而言，每一个共享的环节都可能造成SMP服务器扩展时的瓶颈，而最受限制的则是内存。由于每个CPU必须要通过

- SMP
- 总线型结构

由于SMP在扩展能力上的限制，人们开始探究如何进行有效地扩展从而构建大型系统的技术，NUMA就是这种努力下的结果之一。利用NUMA技术，可以把几十个CPU组合在一个服务器内。

NUMA服务器基本特征：
多个CPU模块
每个模块由多个CPU组成

- NUMA

-CPU物理核心数量越多，并发性越强，不包括线程，超线程在CPU密集型计算，高负载的时候没有任何效果，甚至拖慢系统
-CPU主频越高单次计算越快
-cpu L(1、2、3)缓存越大性能越好
-内存主频按照木桶标准,不同主频不要混插
-多通道的一定按组接入，多cpu要按组对称分布

· cat /proc/cpuinfo
物理id:物理cpu id
core id:核心id
进程

· 一般主板内存槽同族都会标示相同的颜色，在内存槽变上也有数字连线标示，实在不知道，拿手电，趴主板上看。
-raid卡很重要，总体来说贵的好
-raid卡自带内存的，IO会比较强
-raid卡自带电池的，数据安全性好
-当然，我们选择既有内存的又有电池的（笑

·RAID卡指标：
-硬raid卡比软raid好
-这个硬指raid卡带数据存储和专用cpu
-主板上的raid卡多数靠cpu计算，没有和钻用计算机芯片
· raid级别：0、1、5、6、10
-write back性能比write through好
-raid磁盘空间大一些，IO差强人意不适合做数据库
-raid10除了空间浪费多一点整体表现都比raid5好
-raid5磁盘损坏一块之后会有写惩罚，应该及时更换

处理器、电池、内存—— 曾经我没的选，现在我全都要～

·硬盘的指标
  -硬盘15000转的比10000的好
  -做raid不能混用
  -ssd也不错，贵的好（Intel）
  -ssd尤其在随机IO读写上性能非常好
  -如果选择ssd：
    -在格式化分区时要注意4K对齐
    -在内核队列上选择noop效果比较好
    -echo 'noop'>/sys/block/sda/queue/scheduler

mount -t tmpfs		//将内存挂载为硬盘应急

·其他指标
  -网卡一般主办集成
  -显卡，在不是专用图像渲染和挖矿的机器上部重要
  -声卡，有没有都无所谓
  -功耗，这个在选配以后大概计算一下，如果选配设备的最大功耗大于电源模块的最大输出就需要考虑配置多个电源，多个电源有时候不是为了冗余，是因为一个电源根本带不动......
  -其他，散热效果是否好，但这个我们一般无能为力

服务器一般选择：戴尔、惠普
2.跳板机和vpn
 ·如何管理机房的机器
1）进入机房，连接显示器，该干吗干吗
2）远程使用ssh
  -ssh软件xshell
  -ssh软件SecureCRT
3）机房的服务器不是全部都有外网地址的。
  -跳板机（堡垒主机）IDC数据中心
  -vpn
·vpn的英文‘virtual private network’，虚拟专用网络，虚拟的企业内部专线。
·跳板机可以审计但vpn不能
4）机房里的机器是如何管理的？
  -需要去机房就去机房，一般通过ssh连接
  ·你们的机器都是能直接ssh连接的吗？
  -我们跳板机跳进去
  ·怎么安装软件？
  -yum
  ·yum里没有怎么办？
  -做一个扔进yum仓库

3.xshell的使用
·xshell连接

IPMI
4.机房远程管理
  -如果服务器系统崩溃了怎么办？
  -想重新安装系统怎么办？
  -想重做raid怎么办？

  ·基于IPMI协议的服务器带外管理工具
    -IPMI是为服务器管理设计的一种工业标准。为了解决服务器远程管理标准化。
    -IPMI可以监测电源状态，可以下达开关机或重启指令，IPMI的核心是基板控制器（BMC），其完全独立于服务器的CPU、BIOS、操作系统、开关机状态之外，是一个完全独立运行的系统。
    -IPMI功能通过向BMC发送指令完成，指令附合IPMI规范。很多硬件厂商（DELL、HP、IBM）都提供了服务器带外管理工具。
    -Dell的iDrac工具在不购买远程管理卡的情况下，默认就可以提供，可以实现远程重启服务器，查询服务器状态，温度等。

  ·首先机器进入机房以后我们应对iDRAC BMC进程初始化，配置用户名，密码和管理地址。

1.idrac管理界面
  ·字符界面 -- 免费
  ·图形 <-- 需要管理卡支持
  ·作用：监控服务器硬件
2.软件信息
# ipmitool -I lanplus -U root -H 172.17.1.66
